<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Rechnernetze ‚Äì Fragenkatalog Trainer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            bg: "#020617",
            bgSoft: "#020617",
            panel: "#020617",
            accent: "#22d3ee",
            accentSoft: "#0f172a",
          },
          boxShadow: {
            glass: "0 18px 45px rgba(15,23,42,0.9)",
          },
          borderRadius: {
            xl2: "1.5rem",
          },
        },
      },
    };
  </script>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-950 via-slate-950 to-slate-900 text-slate-100 flex items-center justify-center p-4">

  <div class="w-full max-w-6xl rounded-3xl border border-slate-800/70 bg-slate-950/80 shadow-glass backdrop-blur-xl px-4 py-5 sm:px-6 sm:py-6 lg:px-8 lg:py-7">

    <!-- Header -->
    <header class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
      <div>
        <div class="flex items-center gap-3">
          <h1 class="text-lg sm:text-xl font-semibold tracking-wide text-slate-50">
            Rechnernetze ‚Äì Fragenkatalog Trainer
          </h1>
          <span class="hidden sm:inline-flex items-center rounded-full border border-slate-700 px-2.5 py-0.5 text-[0.7rem] font-medium uppercase tracking-[0.18em] text-slate-300">
            Klausurteil
          </span>
        </div>
        <p class="mt-1 text-xs sm:text-sm text-slate-300">
          Lerne nach Kategorien/Themen als Karteikarten oder in einer Liste. Starte eine Pr√ºfungssimulation √ºber den aktuell gefilterten Satz.
        </p>
      </div>

      <!-- Mode Toggle -->
      <div
        class="inline-flex self-end sm:self-auto items-center rounded-full bg-slate-900 border border-slate-700/80 p-1 text-xs justify-end"
      >
        <button
          id="modeCardsBtn"
          class="flex items-center gap-1.5 rounded-full px-3 py-1.5 font-semibold tracking-[0.12em] uppercase text-slate-100 bg-slate-900"
        >
          Karten
        </button>
        <button
          id="modeListBtn"
          class="flex items-center gap-1.5 rounded-full px-3 py-1.5 font-semibold tracking-[0.12em] uppercase text-slate-400 transition hover:text-slate-100"
        >
          Liste
        </button>
      </div>

    </header>

    <!-- Content Grid -->
    <div class="mt-5 grid gap-4 md:grid-cols-[minmax(0,2.1fr)_minmax(0,1.2fr)]">

      <!-- Left Panel -->
      <section class="flex flex-col gap-6 mx-auto w-full max-w-3xl items-center text-center h-full justify-center">

        <!-- Flashcard View -->
        <div id="cardsView" class="flex flex-col gap-5 w-full">

          <!-- Progress -->
          <div class="flex items-center justify-between text-sm text-slate-300 w-full">
            <div class="text-base">
              <span id="currentIndexLabel" class="font-semibold text-slate-50">‚Äì</span>
              /
              <span id="filteredCountLabel">‚Äì</span>
              <span class="ml-1 text-slate-400 text-sm">(von <span id="totalCountLabel">‚Äì</span>)</span>
            </div>
          </div>

          <!-- Card -->
          <div
            id="flashcard"
            class="relative flex min-h-[380px] cursor-pointer items-center justify-center rounded-3xl 
                  border border-slate-700 bg-gradient-to-br from-slate-900 via-slate-950 to-slate-900 
                  px-8 py-10 shadow-xl transition-transform duration-150 hover:-translate-y-0.5 hover:shadow-glass w-full"
          >
            <div class="pointer-events-none absolute inset-0 rounded-3xl bg-gradient-to-tr from-cyan-500/8 via-transparent to-sky-500/8"></div>

            <div class="relative z-10 w-full max-w-2xl text-center">
              <p id="cardLabel" class="mb-2 text-sm font-semibold uppercase tracking-[0.22em] text-cyan-300">
                Frage
              </p>

              <p id="cardMeta" class="mb-5 text-xs text-slate-400"></p>

              <h2 id="cardQuestion"
                  class="whitespace-pre-line text-xl sm:text-2xl font-semibold text-slate-50 leading-relaxed">
                ‚Äì
              </h2>

              <p id="cardAnswer"
                class="mt-6 whitespace-pre-line text-lg sm:text-xl text-slate-100 opacity-0 transition-opacity duration-150 leading-relaxed">
              </p>

              <p class="mt-4 text-xs text-slate-400">
                Klick auf die Karte oder dr√ºcke
                <kbd class="rounded bg-slate-800 px-2 py-1 text-[0.7rem]">Leertaste</kbd>,
                um die Antwort zu zeigen.
              </p>
            </div>
          </div>

          <!-- Controls -->
          <div class="flex flex-wrap items-center justify-between gap-4 text-sm mt-2 w-full">
            <div class="flex flex-wrap gap-3">
              <button
                id="prevBtn"
                class="inline-flex items-center gap-2 rounded-full border border-slate-700 bg-slate-900 px-4 py-2 font-medium text-slate-100 transition hover:border-slate-500 hover:bg-slate-800"
              >
                ‚óÄÔ∏è <span>Zur√ºck</span>
              </button>

              <button
                id="nextBtn"
                class="inline-flex items-center gap-2 rounded-full border border-slate-700 bg-slate-900 px-4 py-2 font-medium text-slate-100 transition hover:border-slate-500 hover:bg-slate-800"
              >
                <span>Weiter</span> ‚ñ∂Ô∏è
              </button>

              <button
                id="randomBtn"
                class="inline-flex items-center gap-2 rounded-full border border-cyan-500/40 bg-cyan-500/15 px-4 py-2 font-medium text-cyan-100 transition hover:border-cyan-400 hover:bg-cyan-500/25"
              >
                üé≤ <span>Zuf√§llig</span>
              </button>
            </div>

            <div class="flex flex-wrap items-center gap-2 text-xs text-slate-400">
              <span class="hidden sm:inline">Shortcuts:</span>
              <code class="rounded bg-slate-900 px-2 py-1">‚Üê</code>
              <code class="rounded bg-slate-900 px-2 py-1">‚Üí</code>
              <code class="rounded bg-slate-900 px-2 py-1">Leertaste</code>
            </div>
          </div>

        </div>

        <!-- List View (zentriert, gr√∂√üere Schrift) -->
        <div id="listView" class="hidden flex flex-col gap-4 w-full">
          <div class="flex items-center justify-between text-sm text-slate-300 w-full">
            <div>
              <span id="listCountLabel" class="font-semibold text-slate-50">‚Äì</span>
              <span class="ml-1 text-slate-400 text-sm">Fragen angezeigt</span>
            </div>
          </div>

          <div
            class="max-h-[560px] space-y-4 overflow-y-auto rounded-2xl border border-slate-800 bg-slate-950/90 p-5 pr-4 
                   text-lg scrollbar-thin scrollbar-track-slate-900 scrollbar-thumb-slate-700/80 w-full"
          >
            <ul id="listContainer" class="space-y-5 w-full">
              <!-- JS f√ºllt das hier -->
            </ul>
          </div>
        </div>


      </section>

      <!-- Right Panel: Suche + Filter + Pr√ºfung -->
      <aside class="flex flex-col gap-4 rounded-2xl border border-slate-800 bg-slate-950/90 px-3.5 py-3.5 sm:px-4 sm:py-4">
        <h3 class="text-xs font-semibold uppercase tracking-[0.22em] text-slate-300">
          Steuerung
        </h3>

        <!-- Kategorie -->
        <div class="space-y-1.5">
          <label for="categorySelect" class="text-xs font-medium text-slate-200">Kategorie</label>
          <select
            id="categorySelect"
            class="w-full rounded-xl border border-slate-700 bg-slate-900/90 py-2 px-3 text-xs text-slate-50 focus:border-cyan-500 focus:outline-none focus:ring-1 focus:ring-cyan-500"
          >
            <!-- wird per JS gef√ºllt -->
          </select>
        </div>

        <!-- Thema -->
        <div class="space-y-1.5">
          <label for="topicSelect" class="text-xs font-medium text-slate-200">Thema</label>
          <select
            id="topicSelect"
            class="w-full rounded-xl border border-slate-700 bg-slate-900/90 py-2 px-3 text-xs text-slate-50 focus:border-cyan-500 focus:outline-none focus:ring-1 focus:ring-cyan-500"
          >
            <!-- wird per JS gef√ºllt -->
          </select>
        </div>

        <!-- Suche -->
        <div class="space-y-1.5">
          <label for="searchInput" class="text-xs font-medium text-slate-200">Suche</label>
          <div class="relative">
            <span class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-slate-500">
              üîç
            </span>
            <input
              id="searchInput"
              type="text"
              placeholder="Frage oder Stichwort..."
              class="w-full rounded-xl border border-slate-700 bg-slate-900/90 py-2 pl-9 pr-3 text-xs text-slate-50 placeholder:text-slate-500 focus:border-cyan-500 focus:outline-none focus:ring-1 focus:ring-cyan-500"
            />
          </div>
          <p class="text-[0.7rem] text-slate-400">
            Filtert Fragen/Antworten im gew√§hlten Bereich. Pr√ºfungssimulation nutzt genau diesen gefilterten Satz.
          </p>
        </div>

        <!-- Stats -->
        <div class="mt-1 grid grid-cols-2 gap-2 text-xs">
          <div class="rounded-xl border border-slate-800 bg-slate-950/80 p-3">
            <p class="text-[0.7rem] text-slate-400">Gesamt</p>
            <p class="mt-1 text-lg font-semibold text-slate-50">
              <span id="statsTotal">‚Äì</span>
            </p>
          </div>
          <div class="rounded-xl border border-slate-800 bg-slate-950/80 p-3">
            <p class="text-[0.7rem] text-slate-400">Gefiltert</p>
            <p class="mt-1 text-lg font-semibold text-slate-50">
              <span id="statsFiltered">‚Äì</span>
            </p>
          </div>
        </div>

        <!-- Pr√ºfungssimulation -->
        <div class="mt-2 rounded-2xl border border-cyan-500/40 bg-cyan-500/5 p-3.5 space-y-2">
          <h4 class="text-xs font-semibold uppercase tracking-[0.18em] text-cyan-300">
            Pr√ºfungssimulation
          </h4>
          <p class="text-[0.72rem] text-slate-200">
            Nutzt alle aktuell gefilterten Karten. Falsche Antworten kommen wieder in die Queue, bis du jede Karte einmal
            richtig hattest.
          </p>
          <button
            id="startExamBtn"
            class="w-full rounded-xl bg-cyan-500 px-3 py-2 text-xs font-semibold uppercase tracking-[0.18em] text-slate-950 hover:bg-cyan-400 transition"
          >
            Pr√ºfungssimulation starten
          </button>
        </div>
      </aside>
    </div>
  </div>

  <!-- Fragen-Katalog -->
  <script src="questions.js"></script>

  <!-- MAIN SCRIPT -->
  <script>
    // erwartet: window.CATALOG = { categories: [...] }
    const catalog = (window.CATALOG && window.CATALOG.categories) ? window.CATALOG : { categories: [] };

    // Flache Liste aller Fragen mit Kategorie/Topic-Meta
    const allQuestions = [];
    catalog.categories.forEach(cat => {
      (cat.topics || []).forEach(topic => {
        (topic.questions || []).forEach(q => {
          allQuestions.push({
            id: q.id,
            question: q.question,
            answer: q.answer,
            categoryId: cat.id,
            categoryTitle: cat.title,
            topicId: topic.id,
            topicTitle: topic.title
          });
        });
      });
    });

    // DOM-Refs
    const modeCardsBtn = document.getElementById("modeCardsBtn");
    const modeListBtn = document.getElementById("modeListBtn");
    const cardsView = document.getElementById("cardsView");
    const listView = document.getElementById("listView");

    const card = document.getElementById("flashcard");
    const cardLabel = document.getElementById("cardLabel");
    const cardMeta = document.getElementById("cardMeta");
    const cardQuestion = document.getElementById("cardQuestion");
    const cardAnswer = document.getElementById("cardAnswer");

    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const randomBtn = document.getElementById("randomBtn");

    const searchInput = document.getElementById("searchInput");
    const categorySelect = document.getElementById("categorySelect");
    const topicSelect = document.getElementById("topicSelect");

    const currentIndexLabel = document.getElementById("currentIndexLabel");
    const filteredCountLabel = document.getElementById("filteredCountLabel");
    const totalCountLabel = document.getElementById("totalCountLabel");
    const progressBar = document.getElementById("progressBar");
    const progressLabel = document.getElementById("progressLabel");

    const listCountLabel = document.getElementById("listCountLabel");
    const listContainer = document.getElementById("listContainer");
    const statsTotal = document.getElementById("statsTotal");
    const statsFiltered = document.getElementById("statsFiltered");

    const startExamBtn = document.getElementById("startExamBtn");

    // State
    let mode = "cards";
    let currentIndex = 0;
    let showAnswer = false;
    let searchTerm = "";
    let selectedCategoryId = "all";
    let selectedTopicId = "all";

    function initCategorySelect() {
      categorySelect.innerHTML = "";
      const optAll = document.createElement("option");
      optAll.value = "all";
      optAll.textContent = "Alle Kategorien";
      categorySelect.appendChild(optAll);

      catalog.categories.forEach(cat => {
        const opt = document.createElement("option");
        opt.value = cat.id;
        opt.textContent = cat.title || cat.id;
        categorySelect.appendChild(opt);
      });
    }

    function updateTopicSelect() {
      topicSelect.innerHTML = "";
      const optAll = document.createElement("option");
      optAll.value = "all";
      optAll.textContent = "Alle Themen";
      topicSelect.appendChild(optAll);

      if (selectedCategoryId === "all") return;

      const cat = catalog.categories.find(c => c.id === selectedCategoryId);
      if (!cat) return;

      (cat.topics || []).forEach(topic => {
        const opt = document.createElement("option");
        opt.value = topic.id;
        opt.textContent = topic.title || topic.id;
        topicSelect.appendChild(opt);
      });
    }

    function getFilteredQuestions() {
      let result = allQuestions.slice();

      if (selectedCategoryId !== "all") {
        result = result.filter(q => q.categoryId === selectedCategoryId);
      }

      if (selectedTopicId !== "all") {
        result = result.filter(q => q.topicId === selectedTopicId);
      }

      if (searchTerm) {
        const term = searchTerm.toLowerCase();
        result = result.filter(q =>
          (q.question || "").toLowerCase().includes(term) ||
          (q.answer || "").toLowerCase().includes(term)
        );
      }

      return result;
    }

    function clampIndex(index, len) {
      if (len === 0) return 0;
      if (index < 0) return 0;
      if (index >= len) return len - 1;
      return index;
    }

    function renderCardView(filtered) {
      const total = allQuestions.length;
      const count = filtered.length;

      totalCountLabel.textContent = total;
      filteredCountLabel.textContent = count;
      statsTotal.textContent = total;
      statsFiltered.textContent = count;

      if (count === 0) {
        currentIndexLabel.textContent = "0";
        cardLabel.textContent = "Frage";
        cardMeta.textContent = "Keine Treffer";
        cardQuestion.textContent = "Keine Fragen gefunden. Passe Filter oder Suche an.";
        cardAnswer.textContent = "";
        cardAnswer.style.opacity = 0;
        return;
      }

      currentIndex = clampIndex(currentIndex, count);
      const current = filtered[currentIndex];

      currentIndexLabel.textContent = String(currentIndex + 1);
      cardQuestion.textContent = current.question || "";
      cardAnswer.textContent = current.answer || "";
      cardAnswer.style.opacity = showAnswer ? 1 : 0;
      cardLabel.textContent = showAnswer ? "Antwort" : "Frage";

      cardMeta.textContent = (current.categoryTitle || current.categoryId || "?") +
        " ¬∑ " + (current.topicTitle || current.topicId || "?");
    }

    function renderListView(filtered) {
      const total = allQuestions.length;
      const count = filtered.length;

      listCountLabel.textContent = count;
      statsTotal.textContent = total;
      statsFiltered.textContent = count;

      listContainer.innerHTML = "";

      if (count === 0) {
        const li = document.createElement("li");
        li.className =
          "rounded-xl border border-slate-800 bg-slate-950/90 px-5 py-4 text-lg text-slate-100";
        li.textContent = "Keine Fragen gefunden. Filter/Suche anpassen.";
        listContainer.appendChild(li);
        return;
      }

      filtered.forEach((item, idx) => {
        const li = document.createElement("li");
        li.className =
          "rounded-xl border border-slate-800 bg-slate-900/95 overflow-hidden";

        const header = document.createElement("button");
        header.type = "button";
        header.className =
          "flex w-full items-center justify-between gap-4 px-5 py-4 text-left text-lg text-slate-50";
        header.innerHTML = `
          <span class="flex-1">
            <span class="mr-3 inline-flex h-7 w-7 items-center justify-center rounded-full bg-slate-800 text-sm font-semibold text-slate-100">
              ${idx + 1}
            </span>
            <span class="block text-xs text-cyan-300 mb-1">
              ${item.categoryTitle || item.categoryId} ¬∑ ${item.topicTitle || item.topicId}
            </span>
            <span class="text-base sm:text-lg leading-relaxed">
              ${item.question}
            </span>
          </span>
          <span class="ml-3 text-slate-400 text-sm toggle-icon">‚ñº</span>
        `;

        const answer = document.createElement("div");
        answer.className =
          "hidden border-t border-slate-800/80 bg-slate-950 px-5 py-4 text-base sm:text-lg text-slate-100 whitespace-pre-line leading-relaxed";
        answer.textContent = item.answer || "Keine Antwort hinterlegt.";

        header.addEventListener("click", () => {
          const isHidden = answer.classList.contains("hidden");
          answer.classList.toggle("hidden", !isHidden);

          const icon = header.querySelector(".toggle-icon");
          if (icon) {
            icon.textContent = isHidden ? "‚ñ≤" : "‚ñº";
          }
        });

        li.appendChild(header);
        li.appendChild(answer);
        listContainer.appendChild(li);
      });
    }



    function render() {
      const filtered = getFilteredQuestions();

      if (mode === "cards") {
        cardsView.classList.remove("hidden");
        listView.classList.add("hidden");
        modeCardsBtn.classList.add("bg-slate-900", "text-slate-100");
        modeCardsBtn.classList.remove("text-slate-400");
        modeListBtn.classList.remove("bg-slate-900", "text-slate-100");
        modeListBtn.classList.add("text-slate-400");
        renderCardView(filtered);
      } else {
        listView.classList.remove("hidden");
        cardsView.classList.add("hidden");
        modeListBtn.classList.add("bg-slate-900", "text-slate-100");
        modeListBtn.classList.remove("text-slate-400");
        modeCardsBtn.classList.remove("bg-slate-900", "text-slate-100");
        modeCardsBtn.classList.add("text-slate-400");
        renderListView(filtered);
      }
    }

    // Events
    modeCardsBtn.addEventListener("click", () => {
      mode = "cards";
      render();
    });

    modeListBtn.addEventListener("click", () => {
      mode = "list";
      render();
    });

    searchInput.addEventListener("input", (e) => {
      searchTerm = e.target.value || "";
      currentIndex = 0;
      showAnswer = false;
      render();
    });

    categorySelect.addEventListener("change", (e) => {
      selectedCategoryId = e.target.value || "all";
      selectedTopicId = "all";
      updateTopicSelect();
      currentIndex = 0;
      showAnswer = false;
      render();
    });

    topicSelect.addEventListener("change", (e) => {
      selectedTopicId = e.target.value || "all";
      currentIndex = 0;
      showAnswer = false;
      render();
    });

    card.addEventListener("click", () => {
      if (mode !== "cards") return;
      showAnswer = !showAnswer;
      cardAnswer.style.opacity = showAnswer ? 1 : 0;
      cardLabel.textContent = showAnswer ? "Antwort" : "Frage";
    });

    prevBtn.addEventListener("click", () => {
      const filtered = getFilteredQuestions();
      if (filtered.length === 0) return;
      currentIndex = clampIndex(currentIndex - 1, filtered.length);
      showAnswer = false;
      render();
    });

    nextBtn.addEventListener("click", () => {
      const filtered = getFilteredQuestions();
      if (filtered.length === 0) return;
      currentIndex = clampIndex(currentIndex + 1, filtered.length);
      showAnswer = false;
      render();
    });

    randomBtn.addEventListener("click", () => {
      const filtered = getFilteredQuestions();
      if (filtered.length === 0) return;
      const next = Math.floor(Math.random() * filtered.length);
      currentIndex = next;
      showAnswer = false;
      render();
    });

    // Keyboard-Shortcuts
    document.addEventListener("keydown", (e) => {
      if (e.target === searchInput) return;
      const filtered = getFilteredQuestions();
      if (filtered.length === 0) return;

      if (e.code === "Space") {
        e.preventDefault();
        if (mode === "cards") {
          showAnswer = !showAnswer;
          cardAnswer.style.opacity = showAnswer ? 1 : 0;
          cardLabel.textContent = showAnswer ? "Antwort" : "Frage";
        }
      }
      if (e.key === "ArrowRight") {
        e.preventDefault();
        currentIndex = clampIndex(currentIndex + 1, filtered.length);
        showAnswer = false;
        render();
      }
      if (e.key === "ArrowLeft") {
        e.preventDefault();
        currentIndex = clampIndex(currentIndex - 1, filtered.length);
        showAnswer = false;
        render();
      }
    });

    // Pr√ºfungssimulation starten
    startExamBtn.addEventListener("click", () => {
      const filtered = getFilteredQuestions();
      if (filtered.length === 0) {
        alert("Keine Fragen im aktuellen Filter. Bitte Kategorie/Thema/Suche anpassen.");
        return;
      }

      const params = new URLSearchParams();
      if (selectedCategoryId !== "all") params.set("category", selectedCategoryId);
      if (selectedTopicId !== "all") params.set("topic", selectedTopicId);
      if (searchTerm.trim() !== "") params.set("search", searchTerm.trim());

      const url = "exam.html" + (params.toString() ? "?" + params.toString() : "");
      window.location.href = url;

    });

    // Init
    initCategorySelect();
    updateTopicSelect();
    render();
  </script>

</body>
</html>
